<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="ReviewList">

	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="ReviewVO" type="egovframework.let.shop.mng.review.service.ReviewVO"/>
	<typeAlias  alias="Review" type="egovframework.let.shop.mng.review.service.Review"/>
					
	
	<resultMap id="ReviewList" class="egovframework.let.shop.mng.review.service.ReviewVO"> <!-- property는 vo값 -->
		<result property="s_id" column="S_ID" columnIndex="1"/>
		<result property="sns_idx" column="SNS_IDX" columnIndex="2"/>						 <!-- collum 은 db의 컬럼값 -->
		<result property="r_idx" column="R_IDX" columnIndex="3"/>			  <!-- db의 컬럼 순서 -->
		<result property="p_idx" column="P_IDX" columnIndex="4"/>
		<result property="r_content" column="R_CONTENT" columnIndex="5"/>
		<result property="r_regdate" column="R_REGDATE" columnIndex="6"/>
		<result property="r_delyn" column="R_DELYN" columnIndex="7"/>
		<result property="r_div" column="R_DIV" columnIndex="8"/>
		<result property="sns_score" column="SNS_SCORE" columnIndex="9"/>
		<result property="seller_score" column="SELLER_SCORE" columnIndex="10"/>
		<result property="nickname" column="NICKNAME" columnIndex="11"/>
		<result property="s_nickname" column="S_NICKNAME" columnIndex="12"/>
		<result property="p_name" column="P_NAME" columnIndex="13"/>
	</resultMap>
	
	<select id="EgovReviewDAO.selectReviewList" parameterClass="ReviewVO" resultMap="ReviewList" >
		<![CDATA[
			SELECT
				S_ID
				, SNS_IDX
				, R_IDX 
				, P_IDX
				, R_CONTENT
				, R_REGDATE
				, R_DELYN
				, R_DIV
				, SNS_SCORE
				, SELLER_SCORE
				, NICKNAME
				, S_NICKNAME
				, P_NAME
			FROM(
				SELECT
						A.S_ID
						, A.SNS_IDX
						, A.R_IDX 
						, A.P_IDX
						, A.R_CONTENT
						, A.R_REGDATE
						, A.R_DELYN
						, A.R_DIV
						, A.SNS_SCORE
						, A.SELLER_SCORE
						, A.NICKNAME
						, A.S_NICKNAME
						, B.P_NAME
				FROM(
					SELECT 
						A.S_ID
						, A.SNS_IDX
						, A.R_IDX 
						, A.P_IDX
						, A.R_CONTENT
						, A.R_REGDATE
						, A.R_DELYN
						, A.R_DIV
						, A.SNS_SCORE
						, A.SELLER_SCORE
						, A.NICKNAME
						, B.S_NICKNAME
					FROM(	
						SELECT 
							A.S_ID
							, A.SNS_IDX
							, A.R_IDX 
							, A.P_IDX
							, A.R_CONTENT
							, A.R_REGDATE
							, A.R_DELYN
							, A.R_DIV
							, A.SNS_SCORE
							, A.SELLER_SCORE
							, B.NICKNAME
						FROM REVIEW A, SNSPROFILE B
						WHERE 1=1
						AND A.R_DELYN='N'
						AND A.SNS_IDX=B.SNS_IDX
					) A, SELLER B
					WHERE 1=1
					AND A.S_ID=B.S_ID
				) A, PRODUCT B
				WHERE 1=1
				AND A.P_IDX=B.P_IDX
			) A WHERE 1=1
		]]>			
			<isEqual prepend="AND" property="searchCnd" compareValue="0"> <!-- prepend로 and,or...쓰고 searchCnd값이 0이면 쿼리 문을 실행 시킨다. -->
				<![CDATA[	NICKNAME LIKE CONCAT ('%', #searchWrd#,'%') 		]]>
			</isEqual>
			<isEqual prepend="AND" property="searchCnd" compareValue="1">
				<![CDATA[	S_NICKNAME LIKE CONCAT ('%', #searchWrd#,'%') 		]]>
			</isEqual>	
			<isEqual prepend="AND" property="searchCnd" compareValue="2">
				<![CDATA[	P_NAME LIKE CONCAT ('%', #searchWrd#,'%') 		]]>
			</isEqual>
		<![CDATA[			
			ORDER BY R_REGDATE DESC
			LIMIT #recordCountPerPage# OFFSET #firstIndex#
		]]>					
	</select>
	
	<update id="EgovReviewDAO.updateUserReview" parameterClass="ReviewVO">
	 		<![CDATA[
				UPDATE REVIEW SET 
					R_CONTENT = #r_content#
				WHERE R_IDX = #r_idx#
	 		]]>
	</update>
	
	<update id="EgovReviewDAO.delUserReview" parameterClass="ReviewVO">
	 		<![CDATA[
				UPDATE REVIEW SET 
					R_DELYN = 'Y'
				WHERE R_IDX = #r_idx#
	 		]]>
	</update>
	

	<!-- <select id="EgovMngProDAO.selectMngProListCnt" parameterClass="SnsProfileVO" resultClass="java.lang.Integer" >
		<![CDATA[
			SELECT 
				COUNT(USERID)
			FROM
				SNSPROFILE
			WHERE 1=1
		]]>				
			<isEqual prepend="AND" property="searchCnd" compareValue="0"> prepend로 and,or...쓰고 searchCnd값이 0이면 쿼리 문을 실행 시킨다.
				<![CDATA[	USERID LIKE CONCAT ('%', #searchWrd#,'%') 		]]>
			</isEqual>
			<isEqual prepend="AND" property="searchCnd" compareValue="1">
				<![CDATA[	SNSCODE LIKE CONCAT ('%', #searchWrd#,'%') 		]]>
			</isEqual>	
	</select> -->
	
	<!-- <insert id="EgovSnsUserDAO.insertSnsUser" parameterClass="SnsProfileVO">
		<![CDATA[
			INSERT INTO SNSPROFILE
			(USERID, SNSCODE, NICKNAME, EMAIL, REG_DATE, DEL_YN)
			VALUES
			(#userid#,#snscode#,#nickname#,#email#,SYSDATE(),'N')
		]]>
	</insert> -->
	
	<!-- <insert id="EgovMngProductDAO.insertMngProduct" parameterClass="Product">
		<![CDATA[
			INSERT INTO 테이블명
			(컬럼명, 날짜)
			VALUES
			( #변수명#, SYSDATE()  
			 )			
		]]>
	</insert> -->
	
</sqlMap>
